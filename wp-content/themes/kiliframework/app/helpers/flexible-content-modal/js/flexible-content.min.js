acf.fields.flexible_content||function(e){acf.fields.flexible_content=acf.field.extend({type:"flexible_content",$el:null,$input:null,$values:null,$clones:null,actions:{ready:"initialize",append:"initialize",show:"show"},events:{'click [data-name="add-layout"]':"_open",'click [data-name="remove-layout"]':"_remove",'click [data-name="collapse-layout"]':"_collapse","mouseenter .acf-fc-layout-handle":"_mouseenter"},focus:function(){this.$el=this.$field.find(".acf-flexible-content:first"),this.$input=this.$el.children("input"),this.$values=this.$el.children(".values"),this.$clones=this.$el.children(".clones"),this.o=acf.get_data(this.$el),this.o.min=this.o.min||0,this.o.max=this.o.max||0},count:function(){return this.$values.children(".layout").length},initialize:function(){acf.disable_form(this.$clones,"flexible_content"),this.render()},show:function(){this.$values.find(".acf-field:visible").each(function(){acf.do_action("show_field",e(this))})},render:function(){this.$values.children(".layout").each(function(t){e(this).find("> .acf-fc-layout-handle .acf-fc-layout-order").html(t+1)}),0==this.count()?this.$el.addClass("empty"):this.$el.removeClass("empty"),this.o.max>0&&this.count()>=this.o.max?this.$el.find("> .acf-actions .button").addClass("disabled"):this.$el.find("> .acf-actions .button").removeClass("disabled")},render_layout_title:function(t){var a=t.children("input"),l=a.attr("name").replace("[acf_fc_layout]",""),i={action:"acf/fields/flexible_content/layout_title",field_key:this.$field.data("key"),i:t.index(),layout:a.val(),value:acf.serialize(t,l)};e.ajax({url:acf.get("ajaxurl"),data:acf.prepare_for_ajax(i),dataType:"html",type:"post",success:function(e){e&&t.find("> .acf-fc-layout-handle").html(e)}})},validate_add:function(t){t=t||"";var a=this.o.max,l=this.count();if(a&&l>=a){var i=1==a?"layout":"layouts",o=acf._e("flexible_content","max");return o=o.replace("{max}",a),o=o.replace("{identifier}",acf._e("flexible_content",i)),alert(o),!1}if(t){var n=e(this.$el.children(".tmpl-popup").html()),s=n.find('[data-layout="'+t+'"]'),c=parseInt(s.attr("data-max")),r=this.$values.children('.layout[data-layout="'+t+'"]').length;if(c>0&&r>=c){var i=1==c?"layout":"layouts",o=acf._e("flexible_content","max_layout");return o=o.replace("{max}",r),o=o.replace("{label}",'"'+s.text()+'"'),o=o.replace("{identifier}",acf._e("flexible_content",i)),alert(o),!1}}return!0},validate_remove:function(t){t=t||"";var a=this.o.min,l=this.count();if(a>0&&l<=a){var i=1==a?"layout":"layouts",o=acf._e("flexible_content","min")+", "+acf._e("flexible_content","remove");return o=o.replace("{min}",a),o=o.replace("{identifier}",acf._e("flexible_content",i)),o=o.replace("{layout}",acf._e("flexible_content","layout")),confirm(o)}if(t){var n=e(this.$el.children(".tmpl-popup").html()),s=n.find('[data-layout="'+t+'"]'),c=parseInt(s.attr("data-min")),r=this.$values.children('.layout[data-layout="'+t+'"]').length;if(c>0&&r<=c){var i=1==c?"layout":"layouts",o=acf._e("flexible_content","min_layout")+", "+acf._e("flexible_content","remove");return o=o.replace("{min}",r),o=o.replace("{label}",'"'+s.text()+'"'),o=o.replace("{identifier}",acf._e("flexible_content",i)),o=o.replace("{layout}",acf._e("flexible_content","layout")),confirm(o)}}return!0},sync:function(){var t="collapsed_"+this.$field.data("key"),a=[];this.$values.children(".layout").each(function(t){e(this).hasClass("-collapsed")&&a.push(t)}),acf.update_user_setting(t,a.join(","))},add:function(e,t){if(t=t||!1,!this.validate_add(e))return!1;var a=this.$field,l=this.$clones.children('.layout[data-layout="'+e+'"]');$el=acf.duplicate(l),acf.enable_form($el,"flexible_content"),this.$el.children(".no-value-message").hide(),t?t.before($el):this.$values.append($el),this.doFocus(a),this.render(),acf.validation.remove_error(this.$field),this.sync()},_mouseenter:function(e){if(!this.$values.hasClass("ui-sortable")&&1!=this.o.max){var t=this;this.$values.sortable({items:"> .layout",handle:"> .acf-fc-layout-handle",forceHelperSize:!0,forcePlaceholderSize:!0,scroll:!0,start:function(e,t){acf.do_action("sortstart",t.item,t.placeholder)},stop:function(e,a){t.render(),acf.do_action("sortstop",a.item,a.placeholder)},update:function(e,a){t.$input.trigger("change")}})}},_open:function(t){if(!this.validate_add())return!1;var a=this,l=e(this.$el.children(".tmpl-popup").html()),i={};this.$values.children(".layout").each(function(){var t=e(this).data("layout");i[t]=i[t]?i[t]+1:1}),l.find("a").each(function(){var t=e(this),a=t.data("min")||0,l=t.data("max")||0,o=t.data("layout"),n=i[o]||0;if(l&&n>=l)return void t.addClass("disabled");if(a){var s=a-n,c=acf._e("flexible_content","required"),r=1==s?"layout":"layouts",c=c.replace("{required}",s);if(c=c.replace("{min}",a),c=c.replace("{label} ",""),c=c.replace("{identifier}",acf._e("flexible_content",r)),s>0){var u=e('<span class="badge"></span>').attr("title",c).text(s);t.append(u)}}});var o=null;t.$el.hasClass("acf-icon")&&(o=t.$el.closest(".layout"),o.addClass("-open")),console.log("acaaaaa"),e("body").append(l),this.position_popup(l,t.$el);var n=function(t,i){t.preventDefault(),t.stopImmediatePropagation(),l.off("click","a",s),e("body").off("click",c),l.remove(),null!==o&&o.removeClass("-open"),null!==i&&a.add(i,o)},s=function(t){n(t,e(this).attr("data-layout"))},c=function(e){n(e,null)};l.on("click","a",s),e("body").on("click",c)},position_popup:function(t,a){var l=10;target_w=a.outerWidth(),target_h=a.outerHeight(),target_t=a.offset().top,target_l=a.offset().left,popup_w=t.outerWidth(),popup_h=t.outerHeight();var i=target_t-popup_h,o=target_l+target_w/2-popup_w/2;i-e(window).scrollTop()<l?(t.addClass("-bottom"),i=target_t+target_h):t.addClass("-top"),o<l?(t.addClass("-right"),o=target_l):o+popup_w+l>e(window).width()&&(t.addClass("-left"),o=target_l+target_w-popup_w),t.css({top:i,left:o})},_remove:function(e){console.log("flex _remove");var t=this,a=e.$el.closest(".layout");a.addClass("-open"),acf.tooltip.confirm_remove(e.$el,function(e){e?t.remove_layout(a):a.removeClass("-open")})},remove_layout:function(e){var t=this;if(this.validate_remove(e.attr("data-layout"))){var a=null,l=0;1==this.count()&&(a=this.$el.children(".no-value-message"),l=a.outerHeight()),acf.remove_el(e,function(){null!==a&&a.show(),t.render(),t.$input.trigger("change"),t.sync()},l)}},_collapse:function(e){var t=e.$el.closest(".layout"),a=t.hasClass("-collapsed"),l=a?"show":"hide";this.render_layout_title(t),t.toggleClass("-collapsed"),this.sync(),acf.do_action(l,t,"collapse")}})}(jQuery);